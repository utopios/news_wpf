<Window x:Class="LibraryManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:LibraryManager.ViewModels"
        mc:Ignorable="d"
        Title="{Binding Title}" Height="600" Width="1000"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- DataTemplate pour BookListViewModel -->
        <DataTemplate DataType="{x:Type vm:BookListViewModel}">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Titre -->
                <TextBlock Grid.Row="0" Text="Gestion des Livres" 
                          FontSize="24" FontWeight="Bold" Margin="0,0,0,20"/>

                <!-- Barre de recherche -->
                <Grid Grid.Row="1" Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                            Height="30" VerticalContentAlignment="Center"
                            Margin="0,0,10,0">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>
                    <Button Grid.Column="1" Content="Rechercher" 
                           Command="{Binding SearchCommand}" 
                           Width="100" Height="30" Margin="0,0,10,0"/>
                    <Button Grid.Column="2" Content="Actualiser" 
                           Command="{Binding LoadBooksCommand}" 
                           Width="100" Height="30"/>
                </Grid>

                <!-- Liste des livres -->
                <DataGrid Grid.Row="2" 
                         ItemsSource="{Binding Books}" 
                         SelectedItem="{Binding SelectedBook}"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         SelectionMode="Single"
                         CanUserAddRows="False"
                         CanUserDeleteRows="False"
                         GridLinesVisibility="Horizontal"
                         AlternatingRowBackground="LightGray"
                         Margin="0,0,0,10">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                        <DataGridTextColumn Header="Titre" Binding="{Binding Title}" Width="*"/>
                        <DataGridTextColumn Header="Auteur" Binding="{Binding Author}" Width="200"/>
                        <DataGridTextColumn Header="ISBN" Binding="{Binding ISBN}" Width="150"/>
                        <DataGridTextColumn Header="Catégorie" Binding="{Binding GetCategoryBadge}" Width="150"/>
                        <DataGridTextColumn Header="Statut" Binding="{Binding GetStatusText}" Width="120"/>
                        <DataGridTextColumn Header="Copies dispo." Binding="{Binding AvailableCopies}" Width="100"/>
                        <DataGridTextColumn Header="Total copies" Binding="{Binding TotalCopies}" Width="100"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Boutons d'action -->
                <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Emprunter" 
                           Command="{Binding BorrowBookCommand}" 
                           Width="120" Height="35" Margin="0,0,10,0"
                           Background="LightGreen"/>
                    <Button Content="Supprimer" 
                           Command="{Binding DeleteBookCommand}" 
                           Width="120" Height="35"
                           Background="LightCoral"/>
                </StackPanel>

                <!-- Indicateur de chargement -->
                <Border Grid.Row="0" Grid.RowSpan="4" 
                       Background="#80000000" 
                       Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisConverter}}"
                       HorizontalAlignment="Stretch" 
                       VerticalAlignment="Stretch">
                    <TextBlock Text="Chargement..." 
                              FontSize="20" 
                              Foreground="White" 
                              HorizontalAlignment="Center" 
                              VerticalAlignment="Center"/>
                </Border>
            </Grid>
        </DataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu -->
        <Menu Grid.Row="0" Height="25">
            <MenuItem Header="Livres" Command="{Binding ShowBooksCommand}"/>
            <MenuItem Header="Membres" Command="{Binding ShowMembersCommand}"/>
        </Menu>

        <!-- Content -->
        <ContentControl Grid.Row="1" Content="{Binding CurrentViewModel}"/>

        <!-- Barre de statut -->
        <StatusBar Grid.Row="2" Height="25">
            <StatusBarItem>
                <TextBlock Text="Gestion de Bibliothèque - Version Legacy"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
